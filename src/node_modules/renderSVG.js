const getOptionsFromCode = require('./getOptionsFromCode');

module.exports = async ({ page, encodedCode, bgColor, size, theme }) => {
  const { code, mermaid: config } = getOptionsFromCode(encodedCode);
  const configObj = typeof config === 'string' ? JSON.parse(config) : config;
  if (theme) {
    configObj.theme = theme;
  }

  await page.evaluate(
    async ({ code, configObj, bgColor, size }) => {
      await window.App.render(code, configObj, bgColor, size);
    },
    { code, configObj, bgColor, size }
  );
};
